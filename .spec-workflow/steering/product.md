# Product Overview

## Product Purpose

`lyric-talk` は、歌詞（日本語テキスト）を素材として、指定した文章を“歌詞の断片の組み合わせ”で再現するためのテキストマッチングツールです。

- 入力: 歌詞テキスト（ファイル or 直接入力） + 再現したい文章
- 出力: マッチ結果（再構成されたテキスト、トークンごとの一致根拠、集計）を JSON として保存

主目的は「歌詞から“それっぽく”喋る」を、形態素解析・読み・モーラ（音節）という日本語に寄り添った手がかりで、再現性と説明可能性を持って行うことです。

## Target Users

- **日本語テキストの創作・遊び用途のユーザー**: 歌詞の断片で文章を組み立てたい、言葉遊びをしたい
- **日本語NLPに興味のある開発者/研究者**: 形態素解析（spaCy + GiNZA）・読み・モーラ分割を使ったマッチングの実験をしたい
- **ツール開発者**: CLI を使って自動処理・バッチ処理したい

（注意）歌詞は著作物になり得るため、利用者は権利・利用規約に従って合法的に入手したテキストを入力してください。本ツール自体は歌詞データの配布を目的にしません。

## Key Features

1. **Lyrics Indexing**: spaCy + GiNZA により歌詞を形態素解析し、表層形・読み・品詞・モーラ分割をインデックス化
2. **Deterministic Matching**: 入力文をトークン化し、優先度付きルール（表層形一致 → 読み一致 → モーラ組み合わせ）でマッチ
3. **Explainable Output**: トークン単位の一致根拠（どの歌詞トークン/行から採ったか、モーラの内訳）と集計をユーザーに提示

## Business Objectives

（オープンソース/個人プロジェクト前提の目標）

- 日本語テキストマッチングの実験基盤を整え、改善（精度/速度/説明性）を反復できる状態にする
- ルールベースの一致に加え、将来的な意味的類似（埋め込み）・言い換え（LLM）などの拡張を可能にする
- uvによる依存関係管理を行う。また、uvxにより、本ツールをpython環境構築不要で実行できる環境も構築する
- テスト（pytest）と静的解析（ruff）を前提に、安心して改修できる開発体験を提供する
- DDD + Onion Architectureによるクリーンなアーキテクチャを実装し、拡張性と保守性を確保する

## Success Metrics

- **トークン一致率**: 出力における `no_match` 以外の割合（例: 80% 以上を目標、歌詞/入力の難易度に依存）
- **再現品質**: 人手評価（読みやすさ/自然さ/意図の保持）と、出力の説明可能性（根拠追跡できること）
- **処理時間**: 典型的な歌詞入力（数百〜数千トークン）で実用的な時間で完了すること

## Product Principles

1. **Explainability First**: 「なぜその断片になったか」を追える（出力に根拠を含める。どのマッチング方法でマッチングされたか、マッチングの際に候補に挙がったtokenを記録するなど）
2. **Japanese-aware Matching**: 表層形だけでなく、読み・モーラなど日本語特有の情報を活用する
3. **Reproducibility & Configurability**: 同じ入力から同じ結果が得られる

## Monitoring & Visibility (if applicable)

- **Dashboard Type**: CLI（進捗ログ） + JSON 出力（`output.json`）
- **Real-time Updates**: なし（現状は処理中ログ出力のみ）
- **Key Metrics Displayed**: インデックス統計（トークン数/ユニーク表層形/ユニーク読み/ユニークモーラ）、マッチタイプ別件数
- **Data Persistence**: DuckDBによる永続化層を実装済み（歌詞コーパス、トークン、マッチ結果の履歴管理）

## Future Vision

ルールベース（表層形/読み/モーラ）を土台として、意味や表現の揺れに強い“歌詞会話”へ拡張していきます。

### Potential Enhancements

- **Remote Access**: 実行結果ビューア（Web/ローカルUI）や共有のしやすさ（エクスポート/レポート）
- **Analytics**: 入力と歌詞の差分分析、マッチ失敗理由の集計、精度/速度の継続計測
- **Collaboration**: ルール・辞書・モデル設定の共有、改善提案（PR）に繋がるドキュメント整備
