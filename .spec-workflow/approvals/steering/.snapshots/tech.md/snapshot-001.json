{
  "id": "snapshot_1765608500473_kpxmiuavb",
  "approvalId": "approval_1765608500468_8mbua5y6a",
  "approvalTitle": "Steering: tech.md の承認",
  "version": 1,
  "timestamp": "2025-12-13T06:48:20.473Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Technology Stack\n\n## Project Type\n- **Python 製 CLI ツール**（日本語歌詞を素材に、入力文を再現するためのテキストマッチング）\n- 実行形態: コマンドライン実行 → JSON 出力（`output.json` など）\n- 将来的な拡張余地: 埋め込み検索（ベクトルDB）/ LLM による言い換え・候補生成\n\n## Core Technologies\n\n### Primary Language(s)\n- **Language**: Python >= 3.12\n- **Runtime/Compiler**: CPython\n- **Language-specific tools**:\n  - 依存管理/実行: `uv`（プロジェクト方針）\n  - パッケージング: `hatchling`\n  - エントリポイント: `lyric-talk = \"src.main:main\"`（`pyproject.toml`）\n\n### Key Dependencies/Libraries\n（`pyproject.toml` の依存関係を中心に整理）\n\n- **spaCy (>=3.7.0)**: 日本語形態素解析の基盤\n- **GiNZA (>=5.2.0), ja-ginza (>=5.2.0)**: spaCy 上で日本語解析（読み情報 `Reading` 取得など）\n- **pydantic (>=2.0.0), pydantic-settings (>=2.0.0)**: 設定管理（環境変数/`.env`）\n- **fugashi / unidic-lite / ipadic**: 日本語トークナイザ・辞書（環境により利用）\n- **sentence-transformers / transformers / sentencepiece**: 埋め込み/意味類似などの高度化に備えた依存（利用箇所は今後拡張）\n- **chromadb**: ベクトル検索/永続化の選択肢（将来的にインデックス永続化を行う場合）\n- **ollama**: ローカルLLM連携（将来的な言い換え・候補生成用途）\n\n補足: リポジトリには Node.js 依存（`@pimzino/spec-workflow-mcp`, `@upstash/context7-mcp`）もありますが、これは開発ワークフロー支援（spec/steering）用途で、アプリ本体の実行には必須ではありません。\n\n### Application Architecture\n- **シンプルな「CLI → 解析/インデックス化 → マッチング → JSON 出力」パイプライン型**\n- 現状の主要モジュール:\n  - `src/main.py`: CLI エントリポイント\n  - `src/lyric_index.py`: 歌詞テキストを解析してインデックス構築（表層形/読み/モーラ）\n  - `src/matcher.py`: 入力トークンのマッチング（優先度付きルール）\n  - `src/mora.py`: 読み正規化・モーラ分割\n  - `src/config.py`: 実行時設定（例: `max_mora_length`）\n\n### Data Storage (if applicable)\n- **Primary storage**: なし（現状はメモリ上で処理）\n- **Output**: JSON ファイル（例: `output.json`）\n- **Future option**: ベクトルDB（`chromadb`）によるインデックス/埋め込みの永続化\n\n### External Integrations (if applicable)\n- 現状は基本的に **ローカル完結**（ネットワーク必須の外部 API 連携なし）\n- 将来的に:\n  - **LLM**: `ollama`（ローカルLLMサーバ）\n  - **埋め込みモデル**: `sentence-transformers` / `transformers`\n\n### Monitoring & Dashboard Technologies (if applicable)\n- **Dashboard Framework**: なし（CLI ログ出力が中心）\n- **Real-time Communication**: なし\n- **State Management**: ファイル出力（JSON）\n\n## Development Environment\n\n### Build & Development Tools\n- **Build System**: `hatchling`\n- **Package Management**: `uv`\n- **Development workflow**:\n  - `uv run ...` で実行/テスト/静的解析\n\n### Code Quality Tools\n- **Static Analysis / Lint**: `ruff`\n- **Formatting**: `ruff`（`ruff check . --fix`）\n- **Testing Framework**: `pytest`（`pytest-xdist` により並列実行）\n- **Coverage**: `pytest-cov`\n\n### Version Control & Collaboration\n- **VCS**: Git\n- **Branching Strategy**: 変更提案をブランチで行い、レビュー/マージする運用を想定\n- **Code Review Process**: PR ベースでレビュー（推奨）\n\n### Dashboard Development (if applicable)\n- 本プロジェクトの steering/spec 運用では `spec-workflow-mcp` ダッシュボード（別プロセス）を利用\n\n## Deployment & Distribution (if applicable)\n- **Target Platform(s)**: Python が動く環境（Linux/macOS/Windows 想定）\n- **Distribution Method**: Python パッケージ（将来的に `uvx` で環境構築不要の実行も目標）\n- **Installation Requirements**:\n  - Python >= 3.12\n  - spaCy 日本語モデル（`ja_ginza`）が利用可能であること\n\n## Technical Requirements & Constraints\n\n### Performance Requirements\n- 形態素解析（spaCy + GiNZA）がボトルネックになり得るため、入力サイズ（歌詞行数/トークン数）に応じた実用的な処理時間を維持する\n- マッチングは説明可能性を優先しつつ、将来的に候補探索の最適化（キャッシュ/探索戦略）を検討\n\n### Compatibility Requirements\n- **Platform Support**: クロスプラットフォーム（ただし日本語モデル/辞書周りは環境依存が出やすい）\n- **Dependency Versions**: `pyproject.toml` の範囲を維持\n\n### Security & Compliance\n- デフォルトはローカル処理であり、外部送信は行わない\n- 入力ファイルは任意テキストのため、取り扱いはユーザー責任（権利/機密/個人情報など）\n\n### Scalability & Reliability\n- 現状は単一プロセス/メモリ内処理\n- 将来的に:\n  - インデックス永続化（例: chroma）\n  - 埋め込み計算のキャッシュ\n\n## Technical Decisions & Rationale\n\n### Decision Log\n1. **spaCy + GiNZA 採用**: 日本語の形態素解析と読み（`Reading`）取得を安定して行えるため\n2. **表層形→読み→モーラの優先度付きルール**: 説明可能で、エラー原因を追いやすい構造にするため\n3. **設定を pydantic-settings で管理**: 実験的パラメータ（例: `max_mora_length`）を環境変数/`.env` で安全に切り替えるため\n\n## Known Limitations\n- `ja_ginza` のロード時間が初回実行の体感を左右する\n- 現状のマッチングは「最初に見つかった候補を採用」する場面があり、最適解探索（全体最適）は未実装\n- 意味的類似（埋め込み）や言い換え（LLM）は依存はあるが、コアロジックへの統合は今後の拡張領域\n",
  "fileStats": {
    "size": 6121,
    "lines": 116,
    "lastModified": "2025-12-13T06:48:18.532Z"
  },
  "comments": []
}